<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Element-UI 中 make 自动化构建分析</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/blog/android-icon-36x36.png">
    <meta name="description" content="Welcome Star Lee's blog !">
    <link rel="preload" href="/blog/assets/css/0.styles.7a0018a6.css" as="style"><link rel="preload" href="/blog/assets/js/app.989511ba.js" as="script"><link rel="preload" href="/blog/assets/js/2.571e916c.js" as="script"><link rel="preload" href="/blog/assets/js/18.449403f6.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.61a27ac9.js"><link rel="prefetch" href="/blog/assets/js/11.37148e18.js"><link rel="prefetch" href="/blog/assets/js/12.2eec4498.js"><link rel="prefetch" href="/blog/assets/js/13.884a58a0.js"><link rel="prefetch" href="/blog/assets/js/14.3adb22de.js"><link rel="prefetch" href="/blog/assets/js/15.c1c2f7fe.js"><link rel="prefetch" href="/blog/assets/js/16.be5a8867.js"><link rel="prefetch" href="/blog/assets/js/17.e6b6d817.js"><link rel="prefetch" href="/blog/assets/js/19.21243975.js"><link rel="prefetch" href="/blog/assets/js/20.49ec9af0.js"><link rel="prefetch" href="/blog/assets/js/21.cbaa1f01.js"><link rel="prefetch" href="/blog/assets/js/22.a607aa92.js"><link rel="prefetch" href="/blog/assets/js/23.56ab5c38.js"><link rel="prefetch" href="/blog/assets/js/24.a3150952.js"><link rel="prefetch" href="/blog/assets/js/25.1b84c3f8.js"><link rel="prefetch" href="/blog/assets/js/26.b7a7d7df.js"><link rel="prefetch" href="/blog/assets/js/27.6574d3b4.js"><link rel="prefetch" href="/blog/assets/js/28.e76b20dc.js"><link rel="prefetch" href="/blog/assets/js/29.16570d1c.js"><link rel="prefetch" href="/blog/assets/js/3.e3d12223.js"><link rel="prefetch" href="/blog/assets/js/30.398c9628.js"><link rel="prefetch" href="/blog/assets/js/31.fbbf42c0.js"><link rel="prefetch" href="/blog/assets/js/32.3fc3ce23.js"><link rel="prefetch" href="/blog/assets/js/33.43cc7b88.js"><link rel="prefetch" href="/blog/assets/js/34.01ddd0dc.js"><link rel="prefetch" href="/blog/assets/js/35.a3baebde.js"><link rel="prefetch" href="/blog/assets/js/36.a20eeacb.js"><link rel="prefetch" href="/blog/assets/js/37.c2e9228f.js"><link rel="prefetch" href="/blog/assets/js/38.ef2ef8c2.js"><link rel="prefetch" href="/blog/assets/js/39.d79c9149.js"><link rel="prefetch" href="/blog/assets/js/4.35c41ba6.js"><link rel="prefetch" href="/blog/assets/js/40.60a46301.js"><link rel="prefetch" href="/blog/assets/js/41.f4cb000f.js"><link rel="prefetch" href="/blog/assets/js/42.37486d01.js"><link rel="prefetch" href="/blog/assets/js/43.16538134.js"><link rel="prefetch" href="/blog/assets/js/44.164101dc.js"><link rel="prefetch" href="/blog/assets/js/45.1b5d6e6e.js"><link rel="prefetch" href="/blog/assets/js/46.8d41391a.js"><link rel="prefetch" href="/blog/assets/js/47.483f3b3c.js"><link rel="prefetch" href="/blog/assets/js/48.932f16f7.js"><link rel="prefetch" href="/blog/assets/js/49.76e83947.js"><link rel="prefetch" href="/blog/assets/js/5.7b10027c.js"><link rel="prefetch" href="/blog/assets/js/50.6d629fb7.js"><link rel="prefetch" href="/blog/assets/js/51.07645e38.js"><link rel="prefetch" href="/blog/assets/js/52.43688db2.js"><link rel="prefetch" href="/blog/assets/js/53.36caa4d3.js"><link rel="prefetch" href="/blog/assets/js/54.0037e51c.js"><link rel="prefetch" href="/blog/assets/js/55.1c1548d2.js"><link rel="prefetch" href="/blog/assets/js/56.337d542a.js"><link rel="prefetch" href="/blog/assets/js/57.90f6968d.js"><link rel="prefetch" href="/blog/assets/js/58.887874d8.js"><link rel="prefetch" href="/blog/assets/js/59.e78c93fc.js"><link rel="prefetch" href="/blog/assets/js/6.5964ef22.js"><link rel="prefetch" href="/blog/assets/js/60.5fb5afd7.js"><link rel="prefetch" href="/blog/assets/js/61.4c43600a.js"><link rel="prefetch" href="/blog/assets/js/62.6cd7ad0b.js"><link rel="prefetch" href="/blog/assets/js/63.425348de.js"><link rel="prefetch" href="/blog/assets/js/64.b7aad860.js"><link rel="prefetch" href="/blog/assets/js/65.997c7d4d.js"><link rel="prefetch" href="/blog/assets/js/66.81c50eda.js"><link rel="prefetch" href="/blog/assets/js/67.87610e61.js"><link rel="prefetch" href="/blog/assets/js/68.69fffd19.js"><link rel="prefetch" href="/blog/assets/js/69.6c9f46b1.js"><link rel="prefetch" href="/blog/assets/js/7.020a09ca.js"><link rel="prefetch" href="/blog/assets/js/70.ad097d99.js"><link rel="prefetch" href="/blog/assets/js/71.43e50775.js"><link rel="prefetch" href="/blog/assets/js/72.e85d8cd1.js"><link rel="prefetch" href="/blog/assets/js/73.3731948c.js"><link rel="prefetch" href="/blog/assets/js/74.fac639cf.js"><link rel="prefetch" href="/blog/assets/js/75.ca97a079.js"><link rel="prefetch" href="/blog/assets/js/76.7f1129c9.js"><link rel="prefetch" href="/blog/assets/js/77.9dbb3b87.js"><link rel="prefetch" href="/blog/assets/js/78.a9ada493.js"><link rel="prefetch" href="/blog/assets/js/79.8147b121.js"><link rel="prefetch" href="/blog/assets/js/8.e0b61867.js"><link rel="prefetch" href="/blog/assets/js/80.902509c1.js"><link rel="prefetch" href="/blog/assets/js/81.dde5faa3.js"><link rel="prefetch" href="/blog/assets/js/82.9169af8d.js"><link rel="prefetch" href="/blog/assets/js/83.e27fdf42.js"><link rel="prefetch" href="/blog/assets/js/84.8b7a53ac.js"><link rel="prefetch" href="/blog/assets/js/85.4e264021.js"><link rel="prefetch" href="/blog/assets/js/86.db2055c2.js"><link rel="prefetch" href="/blog/assets/js/87.e96b1fd1.js"><link rel="prefetch" href="/blog/assets/js/88.9dd1dbcb.js"><link rel="prefetch" href="/blog/assets/js/89.b560268e.js"><link rel="prefetch" href="/blog/assets/js/9.0016b4ba.js"><link rel="prefetch" href="/blog/assets/js/90.a7727e60.js"><link rel="prefetch" href="/blog/assets/js/91.4b10b549.js"><link rel="prefetch" href="/blog/assets/js/92.be8014d8.js"><link rel="prefetch" href="/blog/assets/js/93.23d4340e.js"><link rel="prefetch" href="/blog/assets/js/94.d008c180.js"><link rel="prefetch" href="/blog/assets/js/95.85eff390.js"><link rel="prefetch" href="/blog/assets/js/96.3253de50.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.7a0018a6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/engineering/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/blog/element/" class="nav-link router-link-active">
  Element-UI 源码分析
</a></div><div class="nav-item"><a href="/blog/vue-cli/" class="nav-link">
  vue-cli 源码分析
</a></div><div class="nav-item"><a href="/blog/css/" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/blog/html/" class="nav-link">
  html 相关
</a></div><div class="nav-item"><a href="/blog/nodejs/" class="nav-link">
  node.js 相关
</a></div><div class="nav-item"><a href="/blog/wxMini/" class="nav-link">
  小程序 相关
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow down"></span></button> <button type="button" aria-label="Javascript" class="mobile-dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          你不知道的js 读后感
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/dontKnowJs/" class="nav-link">
  上卷
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/blog/javascript/" class="nav-link">
  基础语法
</a></li></ul></div></div><div class="nav-item"><a href="/blog/git/" class="nav-link">
  git
</a></div><div class="nav-item"><a href="/blog/server/" class="nav-link">
  服务器运维
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="KKB 学习记录" class="dropdown-title"><span class="title">KKB 学习记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="KKB 学习记录" class="mobile-dropdown-title"><span class="title">KKB 学习记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-router/" class="nav-link">
  vue-router 实现原理
</a></li><li class="dropdown-item"><!----> <a href="/blog/vuex/" class="nav-link">
  vuex 实现原理
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/" class="nav-link">
  vue 源码分析
</a></li></ul></div></div> <a href="https://github.com/summerstarlee/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/engineering/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/blog/element/" class="nav-link router-link-active">
  Element-UI 源码分析
</a></div><div class="nav-item"><a href="/blog/vue-cli/" class="nav-link">
  vue-cli 源码分析
</a></div><div class="nav-item"><a href="/blog/css/" class="nav-link">
  css 相关
</a></div><div class="nav-item"><a href="/blog/html/" class="nav-link">
  html 相关
</a></div><div class="nav-item"><a href="/blog/nodejs/" class="nav-link">
  node.js 相关
</a></div><div class="nav-item"><a href="/blog/wxMini/" class="nav-link">
  小程序 相关
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow down"></span></button> <button type="button" aria-label="Javascript" class="mobile-dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          你不知道的js 读后感
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/dontKnowJs/" class="nav-link">
  上卷
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/blog/javascript/" class="nav-link">
  基础语法
</a></li></ul></div></div><div class="nav-item"><a href="/blog/git/" class="nav-link">
  git
</a></div><div class="nav-item"><a href="/blog/server/" class="nav-link">
  服务器运维
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="KKB 学习记录" class="dropdown-title"><span class="title">KKB 学习记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="KKB 学习记录" class="mobile-dropdown-title"><span class="title">KKB 学习记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue-router/" class="nav-link">
  vue-router 实现原理
</a></li><li class="dropdown-item"><!----> <a href="/blog/vuex/" class="nav-link">
  vuex 实现原理
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/" class="nav-link">
  vue 源码分析
</a></li></ul></div></div> <a href="https://github.com/summerstarlee/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/element/" aria-current="page" class="sidebar-link">Element-ui 源码解读</a></li><li><a href="/blog/element/project_analyse.html" class="sidebar-link">项目分析</a></li><li><a href="/blog/element/base.html" class="sidebar-link">element 阅读知识点储备</a></li><li><a href="/blog/element/make.html" aria-current="page" class="active sidebar-link">Element-UI 中 make 自动化构建分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/element/make.html#初识-makefile" class="sidebar-link">初识 Makefile</a></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#makefile-文件格式" class="sidebar-link">Makefile 文件格式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/element/make.html#第一行被-分为了两部分。" class="sidebar-link">第一行被 : 分为了两部分。</a></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#第二行必须由一个-tab键开始-后面跟着需要执行的语句" class="sidebar-link">第二行必须由一个 tab键开始，后面跟着需要执行的语句</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#目标-target-与伪目标-phony-target" class="sidebar-link">目标(target)与伪目标(phony target)</a></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#回声" class="sidebar-link">回声 @</a></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#变量" class="sidebar-link">变量</a></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#自动变量" class="sidebar-link">自动变量 $@</a></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#特殊变量-makecmdgoals" class="sidebar-link">特殊变量 MAKECMDGOALS</a></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#函数" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/element/make.html#filter-out-反过滤函数" class="sidebar-link">filter-out 反过滤函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/element/make.html#node-build-bin-new-js-filter-out-makecmdgoals" class="sidebar-link">node build/bin/new.js $(filter-out $@,$(MAKECMDGOALS))</a></li></ul></li><li><a href="/blog/element/build_file.html" class="sidebar-link">&quot;build:file&quot; 分析</a></li><li><a href="/blog/element/theme-chalk.html" class="sidebar-link">theme-chalk 分析</a></li><li><a href="/blog/element/npm_publish.html" class="sidebar-link">参照 Element-ui 的目录结构发布自己的 vue-ui 包</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="element-ui-中-make-自动化构建分析"><a href="#element-ui-中-make-自动化构建分析" class="header-anchor">#</a> Element-UI 中 make 自动化构建分析</h1> <p>在习惯了使用 <code>package.json</code> 中的 <code>src</code> 来书写构建命令之后，看到了 <a href="https://github.com/ElemeFE/element" target="_blank" rel="noopener noreferrer"><code>Element-ui</code><svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的代码仓库中有 <code>Makefile</code> 这样一个文件。于是
Google 一下，发现了这个东西的强大。</p> <p><code>Makefile</code> 是一个适用于 <code>C/C++</code> 的工具，较早作为工程化工具出现在 <code>UNIX</code> 系统中， 通过 <code>make</code> 命令来执行一系列的编译和连接操作。在拥有 <code>make</code> 环境的目录下， 如果存在一个 <code>Makefile</code> 文件。 那么输入 <code>make</code> 命令将会执行 <code>Makefile</code> 文件中的某个目标命令。</p> <h2 id="初识-makefile"><a href="#初识-makefile" class="header-anchor">#</a> 初识 <code>Makefile</code></h2> <p>直接用 <code>Element-UI</code> 的 <code>Makefile</code> 文件作为例子来做演示。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.PHONY: dist test
default: help

install:
	npm install

new:
	node build/bin/new.js $(filter-out $@,$(MAKECMDGOALS))

deploy:
	@npm run deploy

help:
	@echo &quot;   \033[35mmake\033[0m \033[1m命令使用说明\033[0m&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>mac 中，是直接可以执行 make 命令的。 <a href="http://gnuwin32.sourceforge.net/packages/make.htm" target="_blank" rel="noopener noreferrer">Windows下载 make 的 GUN 工具<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>如果电脑中已经在全局安装了 <code>make</code> 命令，那么当我们 clone <code>element</code> 的代码之后，在根目录执行 <code>make install</code> 这句命令将会起到和 <code>npm install</code> 一样的效果。
来看一下 <code>make install</code> 做了什么。</p> <ol><li>执行 <code>make</code> 命令， 在该目录下找到 <code>Makefile</code> 文件。</li> <li>找到 <code>Makefile</code> 文件中对应命令行参数的 <code>install</code> 的目标。这里的目标就是 <code>install:</code></li> <li>执行 <code>npm install</code> 下面的语句。 <code>npm run dev</code></li></ol> <h2 id="makefile-文件格式"><a href="#makefile-文件格式" class="header-anchor">#</a> <code>Makefile</code> 文件格式</h2> <p><code>make</code> 命令本身并不难， 它只是执行其后跟的 <code>target</code>。而 <code>target</code> 具体的内容体现在 <code>Makefile</code> 文件当中。</p> <p><code>Makefile</code> 文件由一系列规则构成，每一条的规则需要明确两件事情：构建目标是什么，以及如何构建。 每一条的规则都遵循一下格式:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;target&gt; : &lt;prerequisites&gt;
[tab] &lt;commands&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="第一行被-分为了两部分。"><a href="#第一行被-分为了两部分。" class="header-anchor">#</a> 第一行被 <code>:</code> 分为了两部分。</h3> <ul><li>前面部分为目标<code>target</code>, 是执行 <code>make target</code> 命令时可以匹配到的目标。</li> <li>后一部分为前置条件(依赖目标), 如果第一行写为 <code>target1: target2 target3</code>, 那么在执行 <code>make target1</code> 的时候，需要先执行 <code>make target2</code> <code>make target3</code> 最后才会执行 <code>target1</code> 下面的  <code>commonds</code> 语句。</li></ul> <h3 id="第二行必须由一个-tab键开始-后面跟着需要执行的语句"><a href="#第二行必须由一个-tab键开始-后面跟着需要执行的语句" class="header-anchor">#</a> 第二行必须由一个 <code>tab</code>键开始，后面跟着需要执行的语句</h3> <blockquote><p>每一个规则的 <code>target</code> 都是必须的， <code>prerequisites</code> 和 第二行都是可选的， 但是两者之间必须至少存在一个。</p></blockquote> <p>只是这一点 <code>Element-UI</code> 项目中的 <code>Makefile</code> 代码就已经可以明白大部分了。但是看到代码中的第一行 <code>.PHONY: dist test</code> 这又是什么呢？</p> <h2 id="目标-target-与伪目标-phony-target"><a href="#目标-target-与伪目标-phony-target" class="header-anchor">#</a> 目标(target)与伪目标(phony target)</h2> <p>每一个规则都会包含一个 <code>target</code>, 在 <code>make</code> 中， <code>target</code> 通常是文件名， 指明这条规则需要构建的对象。<strong>目标可以是一个或者多个文件名， 之间用空格隔开</strong>。</p> <p>当然，除了文件名， <code>target</code> 的名字还可以是具体的操作名称，这类 <code>target</code> 又被称为 <code>伪目标(phony target)</code>。例如下面的 <code>remove</code> 就是一个伪目标。他的作用是删除文件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>remove:
	rm *.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>但是再执行 <code>make remove</code> 的时候，这个目录下刚好也有一个文件叫做remove,那么这条命令是不会被执行的，因为 Make 发现该文件已经存在，就没有必要重新构建了，就会忽略掉这条命令。</p> <p>为了避免这种情况的发生，可以主动声明 remove 是伪目标。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.PHONY: remove
remove:
	rm *.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>当使用 <code>.PHONY:</code> 主动声明 remove 是伪目标之后，make 就不会检查是否存在有 remove 的文件，而是每次都执行 remove 命令。
同样可以看到在 Element 项目中的 Makefile 文件中的第一行就声明了 <code>.PHONY: dist test</code>, 也是为了避免目录中已经存在的文件名导致该命令无法正常执行。</p> <h2 id="回声"><a href="#回声" class="header-anchor">#</a> 回声 @</h2> <p>在 Makefile 文件中 <code>#</code> 表示注释。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>test:
	# 这是一条注释
	touch a.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>当执行 <code>make test</code> 之后，会打印一条注释，然后再创建 a.js 这个文件。</p> <p>当在命令的前面加上 <code>@</code>， 就可以关闭回声。(由于 <code>echo</code> 也相当于输入回声，所以通常在注释和 <code>echo</code> 前面都加上 <code>@</code>)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>test:
	@# 这是测试
	@echo some
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>在 Element 中， 如果执行 <code>make new some</code> 项目中就会生成一个新的组件, 让我们分析 <code>node build/bin/new.js $(filter-out $@,$(MAKECMDGOALS))</code> 这条命令，看一下涉及到的 make 知识。</p></blockquote> <h2 id="变量"><a href="#变量" class="header-anchor">#</a> 变量</h2> <p>Makefile 允许使用等号来自定义变量, 使用 <code>$()</code> 来调用变量。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>txt = hello world
test: 
	@echo $(txt)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="自动变量"><a href="#自动变量" class="header-anchor">#</a> 自动变量 <code>$@</code></h2> <p>Make 命令还提供了一些自动变量，他们的值与当前的规则有关。</p> <p><code>$@</code> 指代的是当前的目标，就是执行 make 命令所匹配的目标。比如执行 <code>make foo</code> 时， <code>$@</code> 就是指 <code>foo</code></p> <p>利用这个变量可以完成对当前目标的简写：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>a.js b.js c.js:
	touch $@
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="特殊变量-makecmdgoals"><a href="#特殊变量-makecmdgoals" class="header-anchor">#</a> 特殊变量 <code>MAKECMDGOALS</code></h2> <p>make 在执行时， 会设置一个特殊的变量 <code>MAKECMDGOALS</code>, 该变量记录了命令行参数指定的目标列表。也就是说使用这个变量，我们可以得到命令行的参数。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create:
	@echo $(MAKECMDGOALS)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>执行命令 <code>make create newCom</code>  将会打印出 <code>create newCom</code> 这两个字段。</p> <h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <p>make 还可以使用函数， 格式如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$(function arguments)
# 或者
${function arguments}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="filter-out-反过滤函数"><a href="#filter-out-反过滤函数" class="header-anchor">#</a> <code>filter-out</code> 反过滤函数</h3> <p>过滤掉 objs 中所有含有 pattert 的内容， 格式:</p> <p><code>$(filter-out pattert, objs)</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>objs = aa bb cc dd ee 
pattert = bb cc ee 
out: 
	@echo $(filter-out $(pattert), $(objs))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>执行 <code>make out</code> 输出 <code>aa dd</code></p> <h2 id="node-build-bin-new-js-filter-out-makecmdgoals"><a href="#node-build-bin-new-js-filter-out-makecmdgoals" class="header-anchor">#</a> <code>node build/bin/new.js $(filter-out $@,$(MAKECMDGOALS))</code></h2> <p>在 Element 中 无论是执行 <code>make new some</code> 还是执行 <code>make new-lang some</code> 逻辑都是向某一个脚本文件传递一个参数。
这条命令首先使用 <code>node</code> 来运行 <code>build/bin/new.js</code> 这个文件， 并且使用 <code>filter-out</code> 函数在命令行的参数中把当前目标去掉。</p> <p>我们可以新建一个 <code>build/bin/new.js</code> 文件， 写入下面的代码，看一下输入内容。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> &lt;!-- build/bin/new.js --&gt;
console.log(process.argv)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>Makefile</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>new:
	node build/bin/new.js $(filter-out $@, $(MAKECMDGOALS))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>执行命令： <code>make new testCom</code> 输出。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[ 'C:\\Program Files\\nodejs\\node.exe',
  'C:\\Users\\***\\Desktop\\***\\a.js',
  'testCom' ]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在 new.js 中我们就可以通过 <code>process.argv[2]</code> 来拿到命令行的参数，来进一步编写脚本。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/27/2020, 9:31:59 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/element/base.html" class="prev">
        element 阅读知识点储备
      </a></span> <span class="next"><a href="/blog/element/build_file.html">
        &quot;build:file&quot; 分析
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.989511ba.js" defer></script><script src="/blog/assets/js/2.571e916c.js" defer></script><script src="/blog/assets/js/18.449403f6.js" defer></script>
  </body>
</html>
